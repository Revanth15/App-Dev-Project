

# Customer Login
@app.route('/login', methods=['GET','POST'])
def login():
    login_form = LoginForm(request.form)        
    if request.method == 'POST' and login_form.validate():
        if login_form.email.data == 'admin@tit.com' and login_form.password.data == 'adminTime':
            flash('You have been logged in', 'success')

        else:
            customers_dict = {}
            db = shelve.open('customers.db', 'r')

            if 'customers_dict' in db:
                customers_dict = db['Customers']

            try:
                for customer in customers_dict.values():
                    if customer.get_email() == login_form.data:
                        if customer.get_password() == login_form.password.data:
                            login_user(customer, remember=login_form.remember.data)

                            # add a next page route
                            next_page = request.args.get('next')
                            return redirect(next_page) if next_page else redirect(url_for("home"))
            except:
                print("Error in retrieving Customers from customers.db")

            else:
                db['Customers'] = customers_dict
                db.close
                flash('Login Unsuccessful. Please check email and password', '')
        return render_template('signUp.html', form=login_form)
        
    return render_template('signUp.html', form=login_form)
